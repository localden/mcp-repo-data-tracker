{{/* Issues Page Content */}}
{{/* Support both direct context and dict with context/repoKey */}}
{{ $context := . }}
{{ $repoKey := "" }}
{{ if reflect.IsMap . }}
  {{ with .context }}{{ $context = . }}{{ end }}
  {{ with .repoKey }}{{ $repoKey = . }}{{ end }}
{{ end }}
{{ $data := partial "load-metrics.html" (dict "context" $context "repoKey" $repoKey) }}
{{ $m := $data.metrics }}

{{ if not $m }}
<div class="alert alert-warning">
  <span>No data available. Run the aggregation script.</span>
</div>
{{ else }}

<!-- Volume Metrics -->
<section class="mb-6">
  <h2 class="text-sm font-semibold mb-3">Volume</h2>
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
    {{ partial "metric-card.html" (dict "label" "Open Issues" "value" $m.issues.open_count) }}
    {{ partial "metric-card.html" (dict "label" "Closed (7 days)" "value" $m.issues.closed_7d) }}
    {{ partial "metric-card.html" (dict "label" "Closed (30 days)" "value" $m.issues.closed_30d) }}
    {{ partial "metric-card.html" (dict "label" "Closed (90 days)" "value" $m.issues.closed_90d) }}
  </div>
</section>

<!-- Response Time -->
<section class="mb-6">
  <h2 class="text-sm font-semibold mb-1">Response Time</h2>
  <p class="text-[10px] text-base-content/40 mb-3">Time to first maintainer response</p>
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
    {{ partial "metric-card.html" (dict "label" "Average" "value" (partial "format-hours.html" $m.issues.response_time.avg_hours)) }}
    {{ partial "metric-card.html" (dict "label" "Median" "value" (partial "format-hours.html" $m.issues.response_time.median_hours)) }}
    {{ partial "metric-card.html" (dict "label" "P90" "value" (partial "format-hours.html" $m.issues.response_time.p90_hours)) }}
    {{ partial "metric-card.html" (dict "label" "P95" "value" (partial "format-hours.html" $m.issues.response_time.p95_hours)) }}
  </div>
</section>

<!-- Issues Needing Attention -->
<section class="mb-6">
  <h2 class="text-sm font-semibold mb-3">Issues Needing Attention</h2>
  <div class="grid grid-cols-3 gap-3">
    {{ partial "metric-card.html" (dict "label" "No response >24h" "value" $m.issues.without_response_24h) }}
    {{ partial "metric-card.html" (dict "label" "No response >7d" "value" $m.issues.without_response_7d) }}
    {{ partial "metric-card.html" (dict "label" "No response >30d" "value" $m.issues.without_response_30d) }}
  </div>
</section>

<!-- Stale Issues -->
<section class="mb-6">
  <h2 class="text-sm font-semibold mb-1">Stale Issues</h2>
  <p class="text-[10px] text-base-content/40 mb-3">Issues with no activity</p>
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
    {{ partial "metric-card.html" (dict "label" "Stale >30 days" "value" $m.issues.stale_30d) }}
    {{ partial "metric-card.html" (dict "label" "Stale >60 days" "value" $m.issues.stale_60d) }}
    {{ partial "metric-card.html" (dict "label" "Stale >90 days" "value" $m.issues.stale_90d) }}
    {{ partial "metric-card.html" (dict "label" "Reopen Rate" "value" (printf "%.0f%%" (mul $m.issues.reopen_rate 100))) }}
  </div>
</section>

<!-- Label Distribution -->
{{ if $m.issues.by_label }}
<section class="mb-6">
  <h2 class="text-sm font-semibold mb-3">Issues by Label</h2>
  <div class="bg-base-100 border border-base-300 rounded-lg p-3">
    <div class="flex flex-wrap gap-1.5">
      {{ range $label, $count := $m.issues.by_label }}
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs border border-base-300 bg-base-200">
        {{ $label }}
        <span class="font-medium">{{ $count }}</span>
      </span>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{ end }}
